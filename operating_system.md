# 操作系统
![操作系统知识图谱](https://user-gold-cdn.xitu.io/2017/5/22/9ec446cf01928b9a62f9d852690476bd?imageslim)

> [操作系统面试重难点总结](https://juejin.im/entry/592257b62f301e006b183b95)
>
> 操作系统历史：[真香警告：即使不学 OS 进阶，也请务必收藏好该文！](https://juejin.im/post/5cf6a3845188253b2441287e)
>
> 从程序执行将操作系统：[1、操作系统概述（操作系统笔记）](https://www.jianshu.com/p/c6f96dee1006)

## 进程与线程

​	按照操作系统中的描述。线程是 CPU 调度的最小单元，同时线程也是一种有限的资源。而进程相当于线程的“容器”，在 PC 和移动设备上指一个程序或者一个应用。一个进程可以包含多个线程。

### 进程

​	当一个程序第一次启动的时候，Android 会启动一个 Linux 进程和一个主线程。

​	默认情况下， 同一应用的所有组件均在相同的进程中运行。如果我们需要控制某个组件所属的进程，则可在 AndroidManifest 文件中执行此操作。

​	组件运行在哪个进程中，是在 AndroidManifest 文件中进行设置的，activity、service、 receiver 和 provider 均支持 android:process 属性，此属性可以指定该组件应在哪个进程运行。我们可以设置此属性，使每个组件均在各自的进程中运行。

#### 优先级

Android 系统将尽量长时间地保持应用进程，但为了新建进程或运行更重要的进程，最终需要移除旧进程来回收内存。为了确定保留或终止哪些进程，系统会根据进程中正在运行的组件以 及这些组件的状态，将每个进程放入 “重要性层次结构” 中。必要时，系统会首先消除重要性最低的进程，然后是重要性相对较高的进程，以此类推，以回收进程。

重要性层次结构一共有 5 级

1、前台进程 — Foreground process

2、可见进程 — Visible process

3、服务进程 — Service process

4、后台进程 — Background process

5、空进程 — Empty process

### 线程

线程在 Android 中是一个很重要的概念，从用途上来说，线程分为主线程和子线程，主线程的 作用是「运行四大组件以及处理它们和用户的交互」，而子线程的作用则是「执行耗时任务， 比如网络请求、I/O 操作等」，由于 Android 的特性，如果在主线程中执行耗时操作那么就会 导致程序无法及时地响应。因此耗时操作必须放在子线程中执行。

#### Android 中的线程形态

除了 Thread 本身以外，在 Android 中可以扮演线程角色的还有很多，比如 AsyncTask 和 IntentService，同时 HandlerThread 也是一种特殊的线程。

尽管 AsyncTask、IntentService 以及 HandlerThread 的「表现形式」都有别于传统的线程，但是它们的本质仍然是传统的线程。



### 死锁

- What? 

  2个或者2个以上的进程，由于竞争资源造成的阻塞现象，如果没有外力的作用，他们将无法推进下去

- 产生的4大条件

  1. 互斥条件

     一个资源每次只能被一个进程使用

  2. 不可剥夺条件

     进程已获得的资源，没有释放之前不能被剥夺

  3. 请求和保持条件

     一个进程因为请求资源而阻塞，对于已经获取的资源保持不放

  4. 环路等待条件

     多个进程之间形成循环等待资源的关系

- 产生的原因

  1. 系统资源不足
  2. 进程运行推进的顺序不合适
  3. 资源分配不当

- 预防

  破坏四大条件

  1. 破坏资源的互斥性，资源能同时使用
  2. 资源可剥夺
  3. 请求可不保持，进程阻塞时可以释放已获取的资源
  4. 进程之间不要形成循环等待资源的关系

- 避免 

  [银行家算法](http://www.sohu.com/a/231485540_164987)

  可用资源、已分配资源、待分配资源 判断此次分配资源不会处于危险状态，才分配资源

- 检测和解除

  破坏4大条件



## CPU 调度





## 进程管理

linux的进程调度算法





 cow机制 

- 参考: [COW奶牛！Copy On Write机制了解一下](https://juejin.im/post/5bd96bcaf265da396b72f855)

  

## 文件系统



## 内存管理

 虚拟内存



虚拟内存的三级页表机制、缺页机制





epoll pipe

select poll epoll 区别



还有elf hook，进程内存区域，brk，fork clone等 